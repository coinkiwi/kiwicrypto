<!DOCTYPE html>

<html>
<head>
  <title>aes256.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="aes256.html">
                aes256.coffee
              </a>
            
              
              <a class="source" href="base64.html">
                base64.coffee
              </a>
            
              
              <a class="source" href="bigint.html">
                bigint.coffee
              </a>
            
              
              <a class="source" href="hmacsha256.html">
                hmacsha256.coffee
              </a>
            
              
              <a class="source" href="kiwicrypto.html">
                kiwicrypto.coffee
              </a>
            
              
              <a class="source" href="random.html">
                random.coffee
              </a>
            
              
              <a class="source" href="sha256.html">
                sha256.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>aes256.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Author: Mariusz Nowostawski (modifications)
All modifications in public domain.</p>
<p>Original implementation by Chris Veness in JavaScript
<a href="http://www.movable-type.co.uk/scripts/aes.html">http://www.movable-type.co.uk/scripts/aes.html</a></p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>@param arr CounterBlock, of 16-bytes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">incrementCounterBlock</span> = <span class="hljs-params">(cb)</span> -&gt;</span>
  index = <span class="hljs-number">15</span>
  cb[index] = cb[index] + <span class="hljs-number">1</span>
  <span class="hljs-keyword">while</span> index &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> cb[index] &gt; <span class="hljs-number">0xff</span>
    cb[index] = <span class="hljs-number">0</span>
    index = index - <span class="hljs-number">1</span>
    cb[index] = cb[index] + <span class="hljs-number">1</span>

  cb[index] = <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> cb[index] &gt; <span class="hljs-number">0xff</span>
  cb</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>converts a single byte into a hex representation (padded to 2-digits)
@param byte byte</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">byteToHex</span> = <span class="hljs-params">(byte)</span> -&gt;</span>
  t = byte.toString(<span class="hljs-number">16</span>)
  t = <span class="hljs-string">'0'</span> + t <span class="hljs-keyword">if</span> byte &lt; <span class="hljs-number">16</span>
  <span class="hljs-keyword">return</span> t</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>converts a hex string into array of bytes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">hexStringToByteArray</span> = <span class="hljs-params">(str)</span> -&gt;</span>
  result = []
  <span class="hljs-keyword">while</span> str.length &gt;= <span class="hljs-number">2</span>
    result.push(parseInt(str.substring(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>), <span class="hljs-number">16</span>))
    str = str.substring(<span class="hljs-number">2</span>, str.length)

  <span class="hljs-keyword">return</span> result</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Converts hexString to asciiString</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">hexStringToAscii</span> = <span class="hljs-params">(str)</span> -&gt;</span>
  result = <span class="hljs-keyword">new</span> Array()
  <span class="hljs-keyword">while</span> str.length &gt;= <span class="hljs-number">2</span>
    result.push(String.fromCharCode(parseInt(str.substring(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>), <span class="hljs-number">16</span>)))
    str = str.substring(<span class="hljs-number">2</span>, str.length)

  <span class="hljs-keyword">return</span> result.join(<span class="hljs-string">''</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>converts a byte array to hex string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">byteArrayToHexString</span> = <span class="hljs-params">(barr)</span> -&gt;</span>
  result = <span class="hljs-keyword">new</span> Array()
  <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> barr
    result.push byteToHex(b)

  <span class="hljs-keyword">return</span> result.join(<span class="hljs-string">''</span>)




<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AES256</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h6 id="-">#</h6>
<p>  private routines, not called externally</p>
<h6 id="-">#</h6>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>sBox is pre-computed multiplicative inverse in GF(2^8)
used in subBytes and keyExpansion [§5.1.1]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  sBox = [<span class="hljs-number">0x63</span>,<span class="hljs-number">0x7c</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x7b</span>,<span class="hljs-number">0xf2</span>,<span class="hljs-number">0x6b</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0xc5</span>,<span class="hljs-number">0x30</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0x2b</span>,<span class="hljs-number">0xfe</span>,
          <span class="hljs-number">0xd7</span>,<span class="hljs-number">0xab</span>,<span class="hljs-number">0x76</span>,
          <span class="hljs-number">0xca</span>,<span class="hljs-number">0x82</span>,<span class="hljs-number">0xc9</span>,<span class="hljs-number">0x7d</span>,<span class="hljs-number">0xfa</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x47</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-number">0xad</span>,<span class="hljs-number">0xd4</span>,<span class="hljs-number">0xa2</span>,<span class="hljs-number">0xaf</span>,<span class="hljs-number">0x9c</span>,
          <span class="hljs-number">0xa4</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0xc0</span>,
          <span class="hljs-number">0xb7</span>,<span class="hljs-number">0xfd</span>,<span class="hljs-number">0x93</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x36</span>,<span class="hljs-number">0x3f</span>,<span class="hljs-number">0xf7</span>,<span class="hljs-number">0xcc</span>,<span class="hljs-number">0x34</span>,<span class="hljs-number">0xa5</span>,<span class="hljs-number">0xe5</span>,<span class="hljs-number">0xf1</span>,<span class="hljs-number">0x71</span>,
          <span class="hljs-number">0xd8</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0x15</span>,
          <span class="hljs-number">0x04</span>,<span class="hljs-number">0xc7</span>,<span class="hljs-number">0x23</span>,<span class="hljs-number">0xc3</span>,<span class="hljs-number">0x18</span>,<span class="hljs-number">0x96</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x9a</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x12</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0xe2</span>,<span class="hljs-number">0xeb</span>,
          <span class="hljs-number">0x27</span>,<span class="hljs-number">0xb2</span>,<span class="hljs-number">0x75</span>,
          <span class="hljs-number">0x09</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0x2c</span>,<span class="hljs-number">0x1a</span>,<span class="hljs-number">0x1b</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x5a</span>,<span class="hljs-number">0xa0</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x3b</span>,<span class="hljs-number">0xd6</span>,<span class="hljs-number">0xb3</span>,<span class="hljs-number">0x29</span>,
          <span class="hljs-number">0xe3</span>,<span class="hljs-number">0x2f</span>,<span class="hljs-number">0x84</span>,
          <span class="hljs-number">0x53</span>,<span class="hljs-number">0xd1</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xed</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0xfc</span>,<span class="hljs-number">0xb1</span>,<span class="hljs-number">0x5b</span>,<span class="hljs-number">0x6a</span>,<span class="hljs-number">0xcb</span>,<span class="hljs-number">0xbe</span>,<span class="hljs-number">0x39</span>,<span class="hljs-number">0x4a</span>,
          <span class="hljs-number">0x4c</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0xcf</span>,
          <span class="hljs-number">0xd0</span>,<span class="hljs-number">0xef</span>,<span class="hljs-number">0xaa</span>,<span class="hljs-number">0xfb</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x4d</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0x85</span>,<span class="hljs-number">0x45</span>,<span class="hljs-number">0xf9</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x7f</span>,<span class="hljs-number">0x50</span>,
          <span class="hljs-number">0x3c</span>,<span class="hljs-number">0x9f</span>,<span class="hljs-number">0xa8</span>,
          <span class="hljs-number">0x51</span>,<span class="hljs-number">0xa3</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x8f</span>,<span class="hljs-number">0x92</span>,<span class="hljs-number">0x9d</span>,<span class="hljs-number">0x38</span>,<span class="hljs-number">0xf5</span>,<span class="hljs-number">0xbc</span>,<span class="hljs-number">0xb6</span>,<span class="hljs-number">0xda</span>,<span class="hljs-number">0x21</span>,<span class="hljs-number">0x10</span>,
          <span class="hljs-number">0xff</span>,<span class="hljs-number">0xf3</span>,<span class="hljs-number">0xd2</span>,
          <span class="hljs-number">0xcd</span>,<span class="hljs-number">0x0c</span>,<span class="hljs-number">0x13</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x97</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0xc4</span>,<span class="hljs-number">0xa7</span>,<span class="hljs-number">0x7e</span>,<span class="hljs-number">0x3d</span>,<span class="hljs-number">0x64</span>,
          <span class="hljs-number">0x5d</span>,<span class="hljs-number">0x19</span>,<span class="hljs-number">0x73</span>,
          <span class="hljs-number">0x60</span>,<span class="hljs-number">0x81</span>,<span class="hljs-number">0x4f</span>,<span class="hljs-number">0xdc</span>,<span class="hljs-number">0x22</span>,<span class="hljs-number">0x2a</span>,<span class="hljs-number">0x90</span>,<span class="hljs-number">0x88</span>,<span class="hljs-number">0x46</span>,<span class="hljs-number">0xee</span>,<span class="hljs-number">0xb8</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0xde</span>,
          <span class="hljs-number">0x5e</span>,<span class="hljs-number">0x0b</span>,<span class="hljs-number">0xdb</span>,
          <span class="hljs-number">0xe0</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x0a</span>,<span class="hljs-number">0x49</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x5c</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0xd3</span>,<span class="hljs-number">0xac</span>,<span class="hljs-number">0x62</span>,<span class="hljs-number">0x91</span>,
          <span class="hljs-number">0x95</span>,<span class="hljs-number">0xe4</span>,<span class="hljs-number">0x79</span>,
          <span class="hljs-number">0xe7</span>,<span class="hljs-number">0xc8</span>,<span class="hljs-number">0x37</span>,<span class="hljs-number">0x6d</span>,<span class="hljs-number">0x8d</span>,<span class="hljs-number">0xd5</span>,<span class="hljs-number">0x4e</span>,<span class="hljs-number">0xa9</span>,<span class="hljs-number">0x6c</span>,<span class="hljs-number">0x56</span>,<span class="hljs-number">0xf4</span>,<span class="hljs-number">0xea</span>,<span class="hljs-number">0x65</span>,
          <span class="hljs-number">0x7a</span>,<span class="hljs-number">0xae</span>,<span class="hljs-number">0x08</span>,
          <span class="hljs-number">0xba</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x25</span>,<span class="hljs-number">0x2e</span>,<span class="hljs-number">0x1c</span>,<span class="hljs-number">0xa6</span>,<span class="hljs-number">0xb4</span>,<span class="hljs-number">0xc6</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0xdd</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x1f</span>,<span class="hljs-number">0x4b</span>,
          <span class="hljs-number">0xbd</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x8a</span>,
          <span class="hljs-number">0x70</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0xb5</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0xf6</span>,<span class="hljs-number">0x0e</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x35</span>,<span class="hljs-number">0x57</span>,<span class="hljs-number">0xb9</span>,<span class="hljs-number">0x86</span>,
          <span class="hljs-number">0xc1</span>,<span class="hljs-number">0x1d</span>,<span class="hljs-number">0x9e</span>,
          <span class="hljs-number">0xe1</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0x98</span>,<span class="hljs-number">0x11</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0xd9</span>,<span class="hljs-number">0x8e</span>,<span class="hljs-number">0x94</span>,<span class="hljs-number">0x9b</span>,<span class="hljs-number">0x1e</span>,<span class="hljs-number">0x87</span>,<span class="hljs-number">0xe9</span>,<span class="hljs-number">0xce</span>,
          <span class="hljs-number">0x55</span>,<span class="hljs-number">0x28</span>,<span class="hljs-number">0xdf</span>,
          <span class="hljs-number">0x8c</span>,<span class="hljs-number">0xa1</span>,<span class="hljs-number">0x89</span>,<span class="hljs-number">0x0d</span>,<span class="hljs-number">0xbf</span>,<span class="hljs-number">0xe6</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x99</span>,<span class="hljs-number">0x2d</span>,<span class="hljs-number">0x0f</span>,<span class="hljs-number">0xb0</span>,
          <span class="hljs-number">0x54</span>,<span class="hljs-number">0xbb</span>,<span class="hljs-number">0x16</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>rCon is Round Constant used for the Key Expansion
[1st col is 2^(r-1) in GF(2^8)] [§5.2]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  rCon = [[<span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],
          [<span class="hljs-number">0x01</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],
          [<span class="hljs-number">0x02</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],
          [<span class="hljs-number">0x04</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],
          [<span class="hljs-number">0x08</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],
          [<span class="hljs-number">0x10</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],
          [<span class="hljs-number">0x20</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],
          [<span class="hljs-number">0x40</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],
          [<span class="hljs-number">0x80</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],
          [<span class="hljs-number">0x1b</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],
          [<span class="hljs-number">0x36</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>]]</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>apply SBox to state S [§5.1.1]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-title">subBytes</span> = <span class="hljs-params">(s, Nb)</span> -&gt;</span>
    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.3</span>]
      <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.(Nb - <span class="hljs-number">1</span>)]
        s[r][c] = sBox[s[r][c]]

    <span class="hljs-keyword">return</span> s</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>shift row r of state S left by r bytes [§5.1.2]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-title">shiftRows</span> = <span class="hljs-params">(s, Nb)</span> -&gt;</span>
    t = <span class="hljs-keyword">new</span> Array(<span class="hljs-number">4</span>)
    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span><span class="hljs-number">.3</span>]
      <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.3</span>]
        t[c] = s[r][(c + r) % Nb] <span class="hljs-comment"># shift into temp copy</span>
      <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.3</span>]
        s[r][c] = t[c]            <span class="hljs-comment"># and copy back</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>note that this will work for Nb=4,5,6, but not 7,8 (always 4 for AES):
see asmaes.sourceforge.net/rijndael/rijndaelImplementation.pdf</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> s</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>combine bytes of each col of state S [§5.1.3]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-title">mixColumns</span> = <span class="hljs-params">(s, Nb)</span> -&gt;</span>
    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.3</span>]
      a = <span class="hljs-keyword">new</span> Array(<span class="hljs-number">4</span>)  <span class="hljs-comment"># 'a' is a copy of the current column from 's'</span>
      b = <span class="hljs-keyword">new</span> Array(<span class="hljs-number">4</span>)  <span class="hljs-comment"># 'b' is a•{02} in GF(2^8)</span>
      <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.3</span>]
        a[i] = s[i][c]
        <span class="hljs-keyword">if</span> s[i][c] &amp; <span class="hljs-number">0x80</span>
          b[i] = s[i][c] &lt;&lt; <span class="hljs-number">1</span> ^ <span class="hljs-number">0x011b</span>
        <span class="hljs-keyword">else</span>
          b[i] = s[i][c] &lt;&lt; <span class="hljs-number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>a[n] ^ b[n] is a•{03} in GF(2^8)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      s[<span class="hljs-number">0</span>][c] = b[<span class="hljs-number">0</span>] ^ a[<span class="hljs-number">1</span>] ^ b[<span class="hljs-number">1</span>] ^ a[<span class="hljs-number">2</span>] ^ a[<span class="hljs-number">3</span>] <span class="hljs-comment"># 2*a0 + 3*a1 + a2 + a3</span>
      s[<span class="hljs-number">1</span>][c] = a[<span class="hljs-number">0</span>] ^ b[<span class="hljs-number">1</span>] ^ a[<span class="hljs-number">2</span>] ^ b[<span class="hljs-number">2</span>] ^ a[<span class="hljs-number">3</span>] <span class="hljs-comment"># a0 * 2*a1 + 3*a2 + a3</span>
      s[<span class="hljs-number">2</span>][c] = a[<span class="hljs-number">0</span>] ^ a[<span class="hljs-number">1</span>] ^ b[<span class="hljs-number">2</span>] ^ a[<span class="hljs-number">3</span>] ^ b[<span class="hljs-number">3</span>] <span class="hljs-comment"># a0 + a1 + 2*a2 + 3*a3</span>
      s[<span class="hljs-number">3</span>][c] = a[<span class="hljs-number">0</span>] ^ b[<span class="hljs-number">0</span>] ^ a[<span class="hljs-number">1</span>] ^ a[<span class="hljs-number">2</span>] ^ b[<span class="hljs-number">3</span>] <span class="hljs-comment"># 3*a0 + a1 + a2 + 2*a3</span>

    <span class="hljs-keyword">return</span> s</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>xor Round Key into state S [§5.1.4]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-title">addRoundKey</span> = <span class="hljs-params">(state, w, rnd, Nb)</span> -&gt;</span>
    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.3</span>]
      <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.(Nb - <span class="hljs-number">1</span>)]
        state[r][c] ^= w[rnd * <span class="hljs-number">4</span> + c][r]

    <span class="hljs-keyword">return</span> state</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>apply SBox to 4-byte word w</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-title">subWord</span> = <span class="hljs-params">(w)</span> -&gt;</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.3</span>]
      w[i] = sBox[w[i]]
    <span class="hljs-keyword">return</span> w</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>rotate 4-byte word w left by one byte</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-title">rotWord</span> = <span class="hljs-params">(w)</span> -&gt;</span>
    tmp = w[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.2</span>]
      w[i] = w[i + <span class="hljs-number">1</span>]
    w[<span class="hljs-number">3</span>] = tmp
    <span class="hljs-keyword">return</span> w</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>AES Cipher function: encrypt ‘input’ state with Rijndael algorithm
applies Nr rounds (10/12/14) using key schedule w for ‘add round key’ stage</p>
<p>@param {Number[]} input 16-byte (128-bit) input state array
@param {Number[][]} w   Key schedule as 2D byte-array (Nr+1 x Nb bytes)
@returns {Number[]}     Encrypted output state array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-title">cipher</span> = <span class="hljs-params">(input, w)</span> -&gt;</span>   <span class="hljs-comment"># main Cipher function [§5.1]</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>block size (in words): no of columns
in state (fixed at 4 for AES)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Nb = <span class="hljs-number">4</span>
    Nr = w.length / Nb - <span class="hljs-number">1</span>   <span class="hljs-comment"># no of rounds: 10/12/14 for 128/192/256-bit keys</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>initialise 4xNb byte-array ‘state’ with input [§3.4]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    state = [[],[],[],[]]
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [ <span class="hljs-number">0.</span>. (<span class="hljs-number">4</span> * Nb - <span class="hljs-number">1</span>)]
      state[i % <span class="hljs-number">4</span>][Math.floor(i / <span class="hljs-number">4</span>)] = input[i]

    state = addRoundKey(state, w, <span class="hljs-number">0</span>, Nb)

    <span class="hljs-keyword">for</span> round <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span>.(Nr - <span class="hljs-number">1</span>)]
      state = subBytes(state, Nb)
      state = shiftRows(state, Nb)
      state = mixColumns(state, Nb)
      state = addRoundKey(state, w, round, Nb)


    state = subBytes(state, Nb)
    state = shiftRows(state, Nb)
    state = addRoundKey(state, w, Nr, Nb)</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>convert state to 1-d array before returning [§3.4]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    output = <span class="hljs-keyword">new</span> Array(<span class="hljs-number">4</span> * Nb)
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.(<span class="hljs-number">4</span> * Nb - <span class="hljs-number">1</span>)]
      output[i] = state[i % <span class="hljs-number">4</span>][Math.floor(i / <span class="hljs-number">4</span>)]

    <span class="hljs-keyword">return</span> output</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Perform Key Expansion to generate a Key Schedule</p>
<p>@param {Number[]} key Key as 16/24/32-byte array
@returns {Number[][]} Expanded key schedule as
2D byte-array (Nr+1 x Nb bytes)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-title">keyExpansion</span> = <span class="hljs-params">(key)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>generate Key Schedule (byte-array Nr+1 x Nb) from Key [§5.2]
block size (in words): no of columns in state
(fixed at 4 for AES)
key length (in words): 4/6/8 for 128/192/256-bit keys
no of rounds: 10/12/14 for 128/192/256-bit keys</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Nb = <span class="hljs-number">4</span>
    Nk = key.length / <span class="hljs-number">4</span>
    Nr = Nk + <span class="hljs-number">6</span>

    w = <span class="hljs-keyword">new</span> Array(Nb * (Nr + <span class="hljs-number">1</span>))
    temp = <span class="hljs-keyword">new</span> Array(<span class="hljs-number">4</span>)

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.(Nk - <span class="hljs-number">1</span>)]
      r = [key[<span class="hljs-number">4</span> * i], key[<span class="hljs-number">4</span> * i + <span class="hljs-number">1</span>], key[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>], key[<span class="hljs-number">4</span> * i + <span class="hljs-number">3</span>]]
      w[i] = r


    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [Nk..(Nb * (Nr + <span class="hljs-number">1</span>)) - <span class="hljs-number">1</span>]
      w[i] = <span class="hljs-keyword">new</span> Array(<span class="hljs-number">4</span>)
      <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.3</span>]
        temp[t] = w[i - <span class="hljs-number">1</span>][t]
      <span class="hljs-keyword">if</span> (i % Nk <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>)
        temp = subWord(rotWord(temp))
        <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.3</span>]
          temp[t] = temp[t] ^ rCon[i / Nk][t]
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Nk &gt; <span class="hljs-number">6</span> <span class="hljs-keyword">and</span> (i % Nk) <span class="hljs-keyword">is</span> <span class="hljs-number">4</span>)
        temp = subWord(temp)

      <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.3</span>]
        w[i][t] = w[i - Nk][t] ^ temp[t]

    <span class="hljs-keyword">return</span> w</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Encrypt a text using AES encryption in Counter mode of operation</p>
<p>Unicode multi-byte character safe</p>
<p>@param {String} plaintext Source text to be encrypted
@param {String} secret Encryption string in hex
@returns {string} Encrypted text, in HEX format.
   The CounterBlock is passed as first 16 bytes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">encrypt</span>: <span class="hljs-function"><span class="hljs-params">(plaintext, secret)</span> -&gt;</span>
    blockSize = <span class="hljs-number">16</span> <span class="hljs-comment"># block size fixed at 16 bytes / 128 bits (Nb=4) for AES</span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>standard allows 128/192/256 bit keys, we only use 256</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    key = hexStringToByteArray(secret)

    <span class="hljs-keyword">if</span> key.length <span class="hljs-keyword">isnt</span> <span class="hljs-number">32</span> <span class="hljs-comment"># key must be 256bits</span>
      <span class="hljs-built_in">console</span>.log <span class="hljs-string">'AES256 encrypt() ERROR: wrong key length'</span>, key.length
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>initialise 1st 8 bytes of counter block with nonce
(NIST SP800-38A §B.2): [0-1] = millisec,
[2-3] = random, [4-7] = seconds
the remaining 8 bytes are random</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    counterBlock = <span class="hljs-keyword">new</span> Array(blockSize)

    nonce = (<span class="hljs-keyword">new</span> Date()).getTime()  <span class="hljs-comment"># timestamp: milliseconds since 1-Jan-1970</span>
    nonceMs = nonce % <span class="hljs-number">1000</span>
    nonceSec = Math.floor(nonce / <span class="hljs-number">1000</span>)
    nonceRnd = Math.floor(Math.random() * <span class="hljs-number">0xffff</span>)

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.1</span>]
      counterBlock[i] = (nonceMs &gt;&gt;&gt; i * <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.1</span>]
      counterBlock[i + <span class="hljs-number">2</span>] = (nonceRnd &gt;&gt;&gt; i * <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.3</span>]
      counterBlock[i + <span class="hljs-number">4</span>] = (nonceSec &gt;&gt;&gt; i * <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">8.</span><span class="hljs-number">.15</span>]
      counterBlock[i] = Math.floor(Math.random() * <span class="hljs-number">0xff</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>and convert it to a string to go on the front of the ciphertext</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ctrTxt = <span class="hljs-string">''</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.15</span>]
      ctrTxt += byteToHex(counterBlock[i])</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>generate key schedule - an expansion of the key into distinct
Key Rounds for each round</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    keySchedule = keyExpansion(key)

    blockCount = Math.ceil(plaintext.length / blockSize)
    ciphertxt = <span class="hljs-keyword">new</span> Array(blockCount)  <span class="hljs-comment"># ciphertext as array of strings</span>

    <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.(blockCount - <span class="hljs-number">1</span>)]</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>encrypt counter block</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cipherCntr = cipher(counterBlock, keySchedule)</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>block size is reduced on final block</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> b &lt; blockCount - <span class="hljs-number">1</span>
        blockLength = blockSize
      <span class="hljs-keyword">else</span>
        blockLength = (plaintext.length - <span class="hljs-number">1</span>) % blockSize + <span class="hljs-number">1</span>

      cipherChar = <span class="hljs-keyword">new</span> Array(blockLength)

      <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.(blockLength - <span class="hljs-number">1</span>)]</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>xor plaintext with ciphered counter char-by-char</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        cipherChar[i] = cipherCntr[i] ^ plaintext.charCodeAt(b * blockSize + i)
        cipherChar[i] = byteToHex(cipherChar[i])

      ciphertxt[b] = cipherChar.join(<span class="hljs-string">''</span>)

      incrementCounterBlock(counterBlock)</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Array.join is more efficient than repeated string concatenation in IE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ciphertext = ctrTxt + ciphertxt.join(<span class="hljs-string">''</span>)

    <span class="hljs-keyword">return</span> ciphertext</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>@param ciphertext as hex string
@param secret as hex string</p>
<p>returns the HEX representation of the plain text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">decrypt</span>: <span class="hljs-function"><span class="hljs-params">(ciphertext, secret)</span> -&gt;</span>
    blockSize = <span class="hljs-number">16</span>

    ciphertext = hexStringToByteArray(ciphertext)
    key = hexStringToByteArray(secret)

    <span class="hljs-keyword">if</span> key.length <span class="hljs-keyword">isnt</span> <span class="hljs-number">32</span>
      <span class="hljs-built_in">console</span>.log <span class="hljs-string">"AES256 decrypt() ERROR: wrong key length "</span>, key.length</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>ERROR, we cannot do the required encryption, we need key of 32-bytes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>recover nonce from 1st 8 bytes of ciphertext</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    counterBlock = <span class="hljs-keyword">new</span> Array(<span class="hljs-number">16</span>)
    ctrTxt = ciphertext.slice(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>)
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.15</span>]
      counterBlock[i] = ctrTxt[i]</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>generate key schedule</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    keySchedule = keyExpansion(key)</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>separate ciphertext into blocks (skipping past initial 16 bytes)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    nBlocks = Math.ceil((ciphertext.length - <span class="hljs-number">16</span>) / blockSize)
    ct = <span class="hljs-keyword">new</span> Array(nBlocks)

    <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.(nBlocks - <span class="hljs-number">1</span>)]
      ct[b] = ciphertext.slice(<span class="hljs-number">16</span> + b * blockSize
        , <span class="hljs-number">16</span> + b * blockSize + blockSize)</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>ciphertext is now array of block-length strings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ciphertext = ct</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>plaintext will get generated block-by-block into array
of block-length strings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    plaintxt = <span class="hljs-keyword">new</span> Array(ciphertext.length)

    <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.(nBlocks - <span class="hljs-number">1</span>)]</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>encrypt counter block</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cipherCntr = cipher(counterBlock, keySchedule)

      plaintxtByte = <span class="hljs-keyword">new</span> Array(ciphertext[b].length)

      <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.ciphertext[b].length - <span class="hljs-number">1</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>xor plaintxt with ciphered counter byte-by-byte</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        plaintxtByte[i] = cipherCntr[i] ^ ciphertext[b][i]
        plaintxtByte[i] = byteToHex plaintxtByte[i]

      plaintxt[b] = plaintxtByte.join(<span class="hljs-string">''</span>)

      incrementCounterBlock(counterBlock)</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>join array of blocks into single plaintext string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    plaintxt = plaintxt.join(<span class="hljs-string">''</span>)

    <span class="hljs-keyword">return</span> plaintxt</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <h1 id="public-api">public API</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-built_in">exports</span>.AES256 = AES256</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h1 id="these-are-only-exported-for-testing-purposes">these are only exported for testing purposes</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-built_in">exports</span>.incrementCounterBlock = incrementCounterBlock
<span class="hljs-built_in">exports</span>.hexStringToByteArray = hexStringToByteArray
<span class="hljs-built_in">exports</span>.hexStringToAscii = hexStringToAscii
<span class="hljs-built_in">exports</span>.byteArrayToHexString = byteArrayToHexString</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
